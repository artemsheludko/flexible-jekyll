---
layout: post
title: "A Better Arduino: Building a Custom Debugger PCB (Part 2)"
date: 2020-07-18 13:32:20 +0300
description: An ST-Link and BMP compatible debugger with USART passthrough.
img: debugger/thumb.jpg # Add image post (optional)
fig-caption: Running Debugger PCB
tags: [black magic probe, ST-Link, debugger, Custom PCB]
---

# Introduction

In [part 1](../peterson-dev-platform) of the "A Better Arduino" series, I
designed the simplest possible STM32F7 breakout board. This first iteration PDP
board is no where near as easy to use as an Arduino. The primary problem that
the user must first properly wire a debugger to the PDP to flash their code. The
secondary problem is the lack of serial / USART functionality to do IO with the
host machine. The goal of the debugger project is to address these issues by
implementing a debugger on custom circuit board that implements serial
communication. Such a circuit could later be embedded into an all in one
development solution with the plug and play functionality of Arduino in
conjunction with a fully featured debugging suite. I completed the debugger
project in order for it to be used with the Queen's Formula team. The ultimate
goal is to lower the barrier to entry of STM32 for new team members so that they
can leverage all of its extra capability without any added complexity.


# Design

- Several Reference designs available online
    - Link to blog posts on ST-Link debuggers
    - Discuss Nucleo Board Reference design as main influence
    - Explain USART pass through and getting UART output from target back to computer over USB
    - Explain how we can program the MCU on the debugger with the ST-link firmware using the debugger we bought from STM
    - Broke out the ST-Link to the MCU on the debugger as well as ST-Link lines that go to the target.

## Schematic

- Mention hierarchal schematic design and embed files. Link to Altium documentation about ports and multi-sheet design
- Altium ports are like net-labels between schematic sheets.

## Layout

- Embed layout here

# Software and Board Bring Up

- Refer to blog posts with downloads to normal ST-Link firmware
- Discuss issues pulling ST-Link firmware with USART pass through support.
- Discovery of black magic probe firmware, link to tutorial used to flash BMP firmware.
    - https://microcontrollerelectronics.com/how-to-convert-an-stm32f103c8t6-into-a-black-magic-probe/
- Demo Video and example connection through gdb, blink an LED on the Mock ECU
